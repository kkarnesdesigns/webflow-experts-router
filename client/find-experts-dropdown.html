<!--
  Find Experts Mega Dropdown Content

  This goes INSIDE your existing Webflow "Navigation Dropdown List" element.
  The content is dynamically loaded from the API.
-->

<div class="mega-dropdown-inner" id="experts-dropdown">
  <!-- Loading state -->
  <div class="mega-dropdown-loading">Loading...</div>
</div>

<script>
(function() {
  const DROPDOWN_API = 'https://webflow-experts-router.vercel.app/api/dropdown-menu';
  const container = document.getElementById('experts-dropdown');

  async function loadDropdownData() {
    try {
      const response = await fetch(DROPDOWN_API);
      if (!response.ok) throw new Error('Failed to load menu');
      const data = await response.json();
      renderDropdown(data);
    } catch (error) {
      console.error('Error loading dropdown:', error);
      container.innerHTML = '<div class="mega-dropdown-error">Unable to load menu</div>';
    }
  }

  function renderDropdown(data) {
    const { states, cities, categories, popularSkills } = data;

    container.innerHTML = `
      <!-- Column 1: By State -->
      <div class="mega-dropdown-column">
        <div class="mega-dropdown-title">By State</div>
        <div class="mega-dropdown-list mega-dropdown-list--scroll">
          ${states.map(s => `<a href="${s.path}" class="mega-dropdown-link">${s.name}</a>`).join('')}
        </div>
      </div>

      <!-- Column 2: By City -->
      <div class="mega-dropdown-column">
        <div class="mega-dropdown-title">By City</div>
        <div class="mega-dropdown-list mega-dropdown-list--scroll">
          ${cities.map(c => `<a href="${c.path}" class="mega-dropdown-link">${c.name}</a>`).join('')}
        </div>
      </div>

      <!-- Column 3: By Category -->
      <div class="mega-dropdown-column">
        <div class="mega-dropdown-title">By Category</div>
        <div class="mega-dropdown-list">
          ${categories.slice(0, 12).map(c => `<a href="/hire/new-york/${c.slug}" class="mega-dropdown-link">${c.name}</a>`).join('')}
        </div>
        <a href="/hire" class="mega-dropdown-view-all">View All Categories â†’</a>
      </div>

      <!-- Column 4: Popular Skills + CTA -->
      <div class="mega-dropdown-column">
        <div class="mega-dropdown-title">Popular Skills</div>
        <div class="mega-dropdown-list">
          ${popularSkills.map(s => `<a href="/hire/new-york/${s.categorySlug}/${s.slug}" class="mega-dropdown-link">${s.name}</a>`).join('')}
        </div>

        <!-- CTA Box -->
        <div class="mega-dropdown-cta">
          <div class="mega-dropdown-cta-title">Need help finding an expert?</div>
          <div class="mega-dropdown-cta-text">Tell us about your project and we'll match you.</div>
          <a href="/post-project" class="mega-dropdown-cta-btn">Post a Project</a>
        </div>
      </div>
    `;
  }

  // Load on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadDropdownData);
  } else {
    loadDropdownData();
  }
})();
</script>
